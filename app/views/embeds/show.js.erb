function registerClick(widget) {
  var xmlhttp = new XMLHttpRequest();
  widgetID = "widget_id=" + widget.getAttribute('data-id');
  console.log(widgetID);
  console.log("hello");
  xmlhttp.open("POST", "http://localhost:3000/clicks", false);
  xmlhttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
  xmlhttp.setRequestHeader('Content-length', widgetID.length);
  xmlhttp.setRequestHeader('Connection', 'close');

  console.log("goodbye");
  xmlhttp.send(widgetID);
}

document.write("<%= escape_javascript(render(:partial => 'widget', :locals => {:widget => @widget})).html_safe %>");
var widget = document.getElementById("donate_button");
console.log(widget);
widget.addEventListener("click", function() {registerClick(widget)}, false);

// var widget = document.getElementById("widget-template").innerHTML;
// var widgetID = document.getElementsByName("widget_id")[0].getAttribute("content");
// xmlhttp = new XMLHttpRequest();
// xmlhttp.open("GET", "/widgets/" + widgetID + ".json", false);
// xmlhttp.send();
// var response = JSON.parse(xmlhttp.response);
// var matches = widget.match(/{{(\w+)}}/g);
// for (var i=0; i < matches.length; i++) {
//   var match = matches[i];
//   key = match.replace(/[{}]+/g,'');
//   if (response.hasOwnProperty(key)) {
//     widget = widget.replace(new RegExp(match, 'g'), response[key]);
//   }
// }
// document.getElementById('widget').innerHTML = widget;